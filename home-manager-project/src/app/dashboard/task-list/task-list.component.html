<div class="task-list-container">
  <h2>–°–ø–∏—Å–æ–∫ –∑–∞–≤–¥–∞–Ω—å</h2>
  <ul>
    <li *ngFor="let task of tasks">
      <div class="task-card" (click)="toggleTaskDetails(task.taskId)">
        <h3>
          <input type="checkbox"
            [checked]="task.isCompleted"
            (click)="toggleCompleted(task)" />
          {{ task.title }}</h3>
        <p>–í–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ: {{ task.dueDate | date:'dd.MM.yyyy' }}</p>
        <p [class.completed]="task.isCompleted">
          {{ task.isCompleted ? '–í–∏–∫–æ–Ω–∞–Ω–æ' : '–ù–µ –≤–∏–∫–æ–Ω–∞–Ω–æ' }}
        </p>
      </div>

      <div *ngIf="expandedTaskId === task.taskId" class="task-details">
        <p><strong>–û–ø–∏—Å:</strong> {{ task.description }}</p>
        <p><strong>–°—Ç–≤–æ—Ä–µ–Ω–æ:</strong> {{ task.createdAt | date:'dd.MM.yyyy, HH:mm' }}</p>
        <p><strong>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π:</strong> {{ getAssigneeName(task.assigneeId) }}</p>
        <div class="attachments-list" *ngIf="attachments[task.taskId]?.length">
          <p><strong>–í–∫–ª–∞–¥–µ–Ω–Ω—è:</strong></p>
          <ul>
            <li *ngFor="let file of attachments[task.taskId]">
              <ng-container *ngIf="isImage(file.FilePath); else downloadLink">
                <img [src]="file.FilePath" alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è" class="preview-image" />
              </ng-container>
              <ng-template #downloadLink>
                <a [href]="file.FilePath" target="_blank">
                 {{ extractFileName(file.FilePath) }}
                </a>
              </ng-template>
            </li>
          </ul>
        </div>

        <button class="close-btn" (click)="openDeleteConfirm(task.taskId)">
          –í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è
        </button>
        <div class="comments-block">
          <h4>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h4>
          <ul>
            <li *ngFor="let comment of comments[task.taskId]">
              <strong>{{ comment.userName }}:</strong> {{ comment.text }}
              <button class="delete-btn" (click)="deleteComment(task.taskId, comment.commentId)">üóë</button>
            </li>
          </ul>
          <input type="text" [(ngModel)]="commentTexts[task.taskId]" placeholder="–ù–æ–≤–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä..." />
          <button (click)="addComment(task.taskId)">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
        </div>
      </div>
    </li>
  </ul>

  <button class="add-task-btn" (click)="openModal()">Ôºã</button>

  <!-- –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ -->
  <div class="modal-overlay" *ngIf="isModalOpen">
  <div class="modal-content">
    <h2>–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
    <label>
      –ù–∞–∑–≤–∞
      <input type="text" [(ngModel)]="newTask.title" />
    </label>
    <label>
      –û–ø–∏—Å
      <textarea [(ngModel)]="newTask.description"></textarea>
    </label>
    <label>
      –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π
      <select [(ngModel)]="newTask.assigneeId">
        <option *ngFor="let user of familyUsers" [value]="user.userId">
          {{ user.userName }}
        </option>
      </select>
    </label>
    <label>
      –í–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ:
      <input type="date" [(ngModel)]="newTask.dueDate" />
    </label>
    <label>
      –î–æ–¥–∞—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω–Ω—è
      <input type="file" multiple (change)="onFileSelected($event)" />
    </label>
    <div class="modal-buttons">
      <button (click)="addTask()">–î–æ–¥–∞—Ç–∏</button>
      <button (click)="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>
</div>

<div class="delete-modal-overlay" *ngIf="isDeleteConfirmOpen">
  <div class="delete-modal-content">
    <h2>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h2>
    <p>–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è?</p>
    <div class="delete-modal-buttons">
      <button (click)="confirmDelete()">–¢–∞–∫, –≤–∏–¥–∞–ª–∏—Ç–∏</button>
      <button (click)="closeDeleteConfirm()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>
